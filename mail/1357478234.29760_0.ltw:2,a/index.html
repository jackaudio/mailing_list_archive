<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Re: [Jack-Devel] [PATCH] Test using WITH_OPUS instead of HAVE_OPUS</title>
<style>
pre {background: #fafafa; border: 1px solid #f1f2f3; font-size: 1.2em; padding: 10px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;}
h1 {font-size: 140%;}
.header_table {table-layout: fixed; width: 100%;}
.col1 {width: 120px; vertical-align: top;}
.from {font-weight: bold;}
</style>
</head>
<body>
<h1>Re: [Jack-Devel] [PATCH] Test using WITH_OPUS instead of HAVE_OPUS</h1>
<table class="header_table">
<tr><td class='col1'><a href='../1357476034.26308_0.ltw:2,a/index.html'>Prev</a></td><td><a href='../1357481922.3251_0.ltw:2,a/index.html'>Next</a>&nbsp;&nbsp;<a href='../../index.html#1357478234.29760_0.ltw:2,a'>Index</a></td></tr>
<tr><td class='col1'>Date</td><td>Sun, 06 Jan 2013 13:09:53 +0000 </td></tr>
<tr><td class='col1'>From</td><td><span class="from"> Peter Nelson </span> &lt;[hidden] at fuzzle dot org&gt; </td></tr>
<tr><td class='col1'>To</td><td>Adrian Knoth &lt;[hidden] at drcomp dot erfurt dot thur dot de&gt; </td></tr>
<tr><td class='col1'>Cc</td><td>[hidden] at lists dot jackaudio dot org </td></tr>
<tr><td class='col1'>In-Reply-To</td><td>Adrian Knoth
<a href='../1357476034.26308_0.ltw:2,a/index.html'>Re: [Jack-Devel] [PATCH] Test using WITH_OPUS instead of HAVE_OPUS </a></td></tr>
<tr><td class='col1'>Follow-Up</td><td>Adrian Knoth
<a href='../1357501351.1556_0.ltw:2,a/index.html'>Re: [Jack-Devel] [PATCH] Test using WITH_OPUS instead of HAVE_OPUS </a></td></tr>
</table>
<pre>
Hi,

waf's check_cfg() sets HAVE_OPUS itself, along with whatever magic it
does for CFLAGS and LIBS, if the check is successful, regardless of the
wscript setting it later.

Without the patch it does fail to compile for me.

-- 
Peter Nelson &lt;[hidden]&gt;

On Sun, 2013-01-06 at 13:40 +0100, Adrian Knoth wrote:
&gt; On Tue, Jan 01, 2013 at 10:42:45PM +0000, Peter Nelson wrote:
&gt; 
&gt; Hi!
&gt; 
&gt; &gt; HAVE_OPUS will be set by waf if Opus is available but opus/opus_custom.h
&gt; &gt; is not. WITH_OPUS appears to have been created to resolve this but is
&gt; &gt; never tested against.
&gt; 
&gt; As far as I understand the code (untested, only read the wscript), the
&gt; current code is correct:
&gt; 
&gt;     conf.env['WITH_OPUS'] = False
&gt;     if conf.check_cfg(package='opus', atleast_version='0.9.0' ,
&gt; args='--cflags --libs', mandatory=False):
&gt;         if conf.check_cc(header_name='opus/opus_custom.h',
&gt; mandatory=False):
&gt;             conf.define('HAVE_OPUS', 1)
&gt;             conf.env['WITH_OPUS'] = True
&gt; 
&gt; 
&gt; So HAVE_OPUS is the C define (as in g++ -DHAVE_OPUS=1) while WITH_OPUS
&gt; is the waf-internal variable.
&gt; 
&gt; Which means the C source is correct to check against HAVE_OPUS.
&gt; 
&gt; Does it fail to build for you without your patch?
&gt; 
&gt; 
&gt; Cheers
&gt; 
</pre>
<table class="header_table">
<tr><td class='col1'><a href='../1357476034.26308_0.ltw:2,a/index.html'>Prev</a></td><td><a href='../1357481922.3251_0.ltw:2,a/index.html'>Next</a>&nbsp;&nbsp;<a href='../../index.html#1357478234.29760_0.ltw:2,a'>Index</a></td></tr>
</table>
<p><small>1357478234.29760_0.ltw:2,a&nbsp;&lt;1357477793.4044.3.camel at atropos dot lan dot fuzzle dot org&gt;</small></p>
<!-- Created with Bash Archive Mail -->
</body>
</html>
